const path=require('path'),pino=require('pino'),fs=require('fs'),{default:makeWASocket,DisconnectReason,useMultiFileAuthState,fetchLatestBaileysVersion}=require('@whiskeysockets/baileys');let currentHandler=require('./index');const TerminalUI=require('./database/terminalUI.js');TerminalUI['showBanner']('TED|BOT');function hushConsole(_0x16fa29,_0x5eb53e){const _0x95516f=console[_0x16fa29];return console[_0x16fa29]=function(..._0x1733fe){try{const _0x483ee9=require('util')['format'](..._0x1733fe);for(const _0x4284fc of _0x5eb53e){if(_0x483ee9['includes'](_0x4284fc))return;}}catch(_0x2c79be){}return _0x95516f['apply'](console,_0x1733fe);},_0x95516f;}const __HUSH_PATTERNS__=['Closing\x20session:\x20SessionEntry','Removing\x20old\x20closed\x20session:\x20SessionEntry\x20{}','Closing\x20stale\x20open\x20session','rootKey','ephemeralKeyPair','remoteIdentityKey','baseKey'];hushConsole('info',__HUSH_PATTERNS__),hushConsole('warn',__HUSH_PATTERNS__),hushConsole('log',__HUSH_PATTERNS__);let globalSock=null,reconnectAttempts=0x0;const MAX_RECONNECT_ATTEMPTS=0xa,RECONNECT_DELAY=0x1388;let lastActivityTime=Date['now']();const INACTIVITY_THRESHOLD_MS=0x2*0x3c*0x3c*0x3e8,INACTIVITY_CHECK_INTERVAL_MS=0x1e*0x3c*0x3e8;function limparMensagens(){try{if(globalSock?.['store']?.['messages']){let _0xd1b3d=0x0,_0x34c02e=0x0,_0x439d4d=0x0;for(const [_0x238b59,_0x4f847f]of globalSock['store']['messages']['entries']()){const _0x4e786a=Array['from'](_0x4f847f['values']());_0x34c02e+=_0x4e786a['length'],_0xd1b3d++;if(_0x4e786a['length']>0x64){const _0xe16782=_0x4e786a['sort']((_0x154377,_0x1c4520)=>(_0x1c4520['messageTimestamp']||0x0)-(_0x154377['messageTimestamp']||0x0)),_0x2311f2=_0xe16782['slice'](0x0,0x64);globalSock['store']['messages']['set'](_0x238b59,new Map(_0x2311f2['map'](_0x1ef6f5=>[_0x1ef6f5['key']['id'],_0x1ef6f5]))),_0x439d4d+=0x64;}else _0x439d4d+=_0x4e786a['length'];}_0x34c02e>_0x439d4d&&TerminalUI['status']['info']('üßπ\x20Limpeza\x20conclu√≠da\x20‚Üí\x20'+_0x34c02e+'\x20msgs\x20antes,\x20'+_0x439d4d+'\x20msgs\x20depois\x20(100\x20por\x20chat)');}}catch(_0x521638){TerminalUI['status']['error']('Erro\x20na\x20limpeza\x20de\x20mensagens:\x20'+_0x521638['message']);}}function checkInactivityAndClean(){const _0x3da8ad=Date['now']();_0x3da8ad-lastActivityTime>INACTIVITY_THRESHOLD_MS&&(TerminalUI['status']['warning']('Bot\x20inativo\x20por\x20muito\x20tempo.\x20Realizando\x20limpeza\x20de\x20mensagens...'),limparMensagens(),lastActivityTime=_0x3da8ad);}function setupHotReload(){const _0x26d772=path['resolve'](__dirname,'index.js');let _0x1aaa5e=null,_0x1e4982=0x0;fs['watch'](_0x26d772,(_0x589d7e,_0x3e0293)=>{if(_0x589d7e==='change'&&_0x3e0293==='index.js'){const _0x4eed68=Date['now']();if(_0x4eed68-_0x1e4982<0x7d0)return;if(_0x1aaa5e)clearTimeout(_0x1aaa5e);_0x1aaa5e=setTimeout(()=>{_0x1e4982=Date['now'](),TerminalUI['status']['info']('üìÅ\x20Detectada\x20altera√ß√£o\x20no\x20handler...'),fs['access'](_0x26d772,fs['constants']['F_OK'],_0x1a4809=>{if(_0x1a4809){TerminalUI['status']['warning']('‚è≥\x20Arquivo\x20temporariamente\x20indispon√≠vel,\x20tentando\x20novamente...');return;}try{delete require['cache'][require['resolve']('./index')],currentHandler=require('./index'),TerminalUI['status']['success']('‚úÖ\x20Handler\x20atualizado\x20com\x20sucesso!');}catch(_0x15b286){_0x15b286['code']==='ENOENT'?(TerminalUI['status']['warning']('‚è≥\x20Arquivo\x20n√£o\x20encontrado,\x20tentando\x20novamente\x20em\x202s...'),setTimeout(()=>{try{delete require['cache'][require['resolve']('./index')],currentHandler=require('./index'),TerminalUI['status']['success']('‚úÖ\x20Handler\x20atualizado\x20com\x20sucesso!');}catch(_0x55cc3e){TerminalUI['status']['error']('‚ùå\x20Erro\x20ao\x20recarregar\x20handler:\x20'+_0x55cc3e['message']);}},0x7d0)):TerminalUI['status']['error']('‚ùå\x20Erro\x20ao\x20recarregar\x20handler:\x20'+_0x15b286['message']);}});},0x3e8);}}),TerminalUI['status']['info']('üî•\x20Hot\x20reload\x20ativado\x20(debounce:\x201s)');}async function connect(){const _0x309429=(function(){let _0x24429d=!![];return function(_0x932e6f,_0x50e930){const _0x3c9f4b=_0x24429d?function(){if(_0x50e930){const _0x375ffa=_0x50e930['apply'](_0x932e6f,arguments);return _0x50e930=null,_0x375ffa;}}:function(){};return _0x24429d=![],_0x3c9f4b;};}()),_0x23af74=_0x309429(this,function(){return _0x23af74['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x23af74)['search']('(((.+)+)+)+$');});_0x23af74(),TerminalUI['status']['info']('Iniciando\x20processo\x20de\x20conex√£o...');try{const {state:_0xf8256b,saveCreds:_0x35a239}=await useMultiFileAuthState(path['resolve'](__dirname,'database','qr','ted-qr')),{version:_0x4897ea}=await fetchLatestBaileysVersion(),_0x1b1f9d=makeWASocket({'version':_0x4897ea,'auth':_0xf8256b,'logger':pino({'level':'silent'}),'printQRInTerminal':![],'browser':['Ubuntu','Chrome','20.0.04'],'markOnlineOnConnect':!![]});globalSock=_0x1b1f9d;if(!_0xf8256b['creds']['registered']){TerminalUI['status']['info']('Aguardando\x20pareamento...\x20Por\x20favor,\x20escaneie\x20o\x20QR\x20Code\x20ou\x20insira\x20o\x20c√≥digo.');let _0x24c14f=await TerminalUI['promptInput']('üì±\x20Informe\x20seu\x20n√∫mero\x20com\x20DDI\x20(ex:\x205511999999999)');_0x24c14f=_0x24c14f['replace'](/[^0-9]/g,'');if(!_0x24c14f)return TerminalUI['status']['error']('N√∫mero\x20inv√°lido!\x20Reiniciando\x20conex√£o...'),connect();try{const _0x490415=await _0x1b1f9d['requestPairingCode'](_0x24c14f);TerminalUI['status']['success']('TOKEN\x20DE\x20PAREAMENTO:\x20'+_0x490415),TerminalUI['status']['info']('‚û°Ô∏è\x20Abra\x20o\x20WhatsApp\x20>\x20Dispositivos\x20Conectados\x20>\x20Conectar\x20com\x20c√≥digo');}catch(_0x14c7bc){TerminalUI['status']['error']('Erro\x20ao\x20gerar\x20c√≥digo\x20de\x20pareamento:\x20'+_0x14c7bc['message']),setTimeout(connect,0xbb8);return;}}return _0x1b1f9d['ev']['on']('connection.update',_0xe210f6=>{const {connection:_0x2f64cd,lastDisconnect:_0x50563b}=_0xe210f6;if(_0x2f64cd)TerminalUI['status']['connection']('Status\x20da\x20conex√£o:\x20'+_0x2f64cd);if(_0x2f64cd==='close'){const _0x4019d0=_0x50563b?.['error']?.['output']?.['statusCode']!==DisconnectReason['loggedOut'];_0x4019d0?(reconnectAttempts++,reconnectAttempts<=MAX_RECONNECT_ATTEMPTS?(TerminalUI['status']['warning']('Reconectando\x20em\x20'+RECONNECT_DELAY/0x3e8+'s...\x20(Tentativa\x20'+reconnectAttempts+'/'+MAX_RECONNECT_ATTEMPTS+')'),setTimeout(connect,RECONNECT_DELAY)):(TerminalUI['status']['error']('M√°ximo\x20de\x20tentativas\x20de\x20reconex√£o\x20atingido.\x20Reiniciando...'),reconnectAttempts=0x0,setTimeout(connect,RECONNECT_DELAY))):TerminalUI['status']['error']('Desconectado\x20permanentemente.\x20Por\x20favor,\x20reinicie\x20o\x20bot\x20manualmente.');}else _0x2f64cd==='open'&&(TerminalUI['status']['success']('CONECTADO\x20COM\x20SUCESSO!\x20Bot\x20Online.'),reconnectAttempts=0x0,setupHotReload(),setTimeout(()=>limparMensagens(),0xbb8),setInterval(checkInactivityAndClean,INACTIVITY_CHECK_INTERVAL_MS));}),_0x1b1f9d['ev']['on']('messages.upsert',_0x4f4fac=>{lastActivityTime=Date['now'](),currentHandler(_0x4f4fac,_0x1b1f9d),limparMensagens();}),_0x1b1f9d['ev']['on']('creds.update',_0x35a239),_0x1b1f9d['ev']['on']('group-participants.update',_0x4d6f94=>{lastActivityTime=Date['now'](),currentHandler({'group-participants':{'update':_0x4d6f94}},_0x1b1f9d);}),_0x1b1f9d;}catch(_0x5bb608){TerminalUI['status']['error']('ERRO\x20FATAL\x20NA\x20CONEX√ÉO:\x20'+_0x5bb608['message']+'.\x20Tentando\x20reconectar\x20em\x205s...'),setTimeout(connect,0x1388);}}connect();